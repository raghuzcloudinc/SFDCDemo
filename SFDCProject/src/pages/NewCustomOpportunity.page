<apex:page standardcontroller="Opportunity" Extensions="NewCustomOpportunityController" tabstyle="Opportunity">
    
    <apex:pageMessages id="pmId"/>
    
    <apex:form id="formId">
           <div align="center">
                <apex:commandButton title="Submit"  rendered="{!NOT(enableConfirmSave)}" value="  Save " action="{!submit}"/>
                <apex:commandButton title="Confirm"  rendered="{!(enableConfirmSave)}" value="  Confirm " action="{!confirmSubmit}"/>
                &nbsp;
                <apex:commandButton action="{!cancel}" value="Cancel" onclick="return confirmCancel()" immediate="true"/>
            </div>
             &nbsp;  
            <div align = "Right">
            <apex:pageblock >                 
                <apex:outputPanel layout="block" styleClass="requiredInput">
                        <apex:outputPanel layout="block" styleClass="redrequired" />
                        <apex:outputtext value=" = Required to save opportunity"></apex:outputtext>
                </apex:outputPanel>                
                <apex:outputPanel layout="block" styleClass="requiredInput">
                        <apex:outputPanel layout="block" styleClass="bluerequired" />
                        <apex:outputtext value=" = Required to create design"></apex:outputtext>
                </apex:outputPanel>

            </apex:pageblock> 
            </div>
            
        <apex:pageblock id="ContactDetailsId" >

            <apex:pageblocksection collapsible="true" title="Contact Information" columns="2">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="First Name" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="FirstName" value="{!contactObj.Firstname}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Name" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="LastName" value="{!contactObj.Lastname}">
                        </apex:inputfield>                      
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 
                <apex:outputpanel id="address" rendered="{!IsBlank($CurrentPage.parameters.gmaps)}">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Street" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="Street" style="width: 155px; height: 45px;"  value="{!accountObj.BillingStreet}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>       
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Address Validation Status" />
                    <apex:outputtext value="{!AddValidStateVal}"/>
                </apex:pageBlockSectionItem>             
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="City" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="City" value="{!accountObj.BillingCity}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>     
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Zip+6" />
                    <apex:outputtext value="{!Zip6Val}"/>
                </apex:pageBlockSectionItem>            
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="State" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="State" value="{!accountObj.State__c}">
                            <apex:actionSupport rerender="utilitiySection" event="onchange" action="{!getUtilities}"/>
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>   
                <apex:pageBlockSectionItem />             
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Zip Code" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="postalCode" value="{!accountObj.BillingPostalCode}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>  
                <apex:pageBlockSectionItem />   
                <!--  <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Country" />
                    <apex:outputPanel layout="block" styleClass="requiredInput">
                    <apex:outputPanel layout="block" styleClass="requiredBlock"/>
                        <apex:inputfield id="country" value="{!contactObj.Mailingcountry}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> -->
                <!--
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Country" />                    
                    <apex:outputText id="country" value=" USA "/>
                </apex:pageBlockSectionItem>
                -->
                <!--<apex:pageBlockSectionItem />   -->
                <!-- 
                 <apex:pageBlockSectionItem id="pbsiCB">     
                   <apex:commandButton id="validateAdd" value="Validate Address" action="{!validateAddress}" rerender="addressSection,pmId" oncomplete="document.getElementById('{!$Component.formId.ContactDetailsId.addressSection.pbsiCB.validateAdd}').focus();"/> 
                </apex:pageBlockSectionItem>
                -->
            </apex:outputpanel>                
                <apex:pageBlockSectionItem rendered="{!Not(IsBlank($CurrentPage.parameters.gmaps))}">
                        <apex:outputLabel value="Address" for="gmapsAddress" />
                    <!-- <c:gmapAddress id="gmapsAddress" street="{!accountObj.BillingStreet}" city="{!accountObj.BillingCity}" state="{!accountObj.State__c}" postalCode="{!accountObj.BillingPostalCode}" country="{!contactObj.Mailingcountry}" edit="true"></c:gmapAddress>-->
                    <c:gmapsLeadAddress id="gmapsAddress" street="{!accountObj.BillingStreet}" city="{!accountObj.BillingCity}" state="{!accountObj.State__c}" postalCode="{!accountObj.BillingPostalCode}" country="{!contactObj.Mailingcountry}" latitude="{!accountObj.Latitude__c}" longitude="{!accountObj.Longitude__c}" edit="true"></c:gmapsLeadAddress>                    
                </apex:pageBlockSectionItem>
                <apex:pageblockSectionItem rendered="{!Not(IsBlank($CurrentPage.parameters.gmaps))}">
                    <apex:outputLabel value="County"/>
                    <apex:inputfield value="{!accountObj.County__c}"/>                    
                </apex:pageblockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Home Type" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="hometype" value="{!opportunity.Home_Type__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                                                                                                                                          
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Phone" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                    <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputfield id="Phone" value="{!contactObj.phone}" onkeydown="javascript:backspacerDOWN(this,event);" onkeyup="javascript:backspacerUP(this,event);">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                                                  
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Alternate Phone" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="OtherPhone" value="{!contactObj.otherphone}" onkeydown="javascript:backspacerDOWN(this,event);" onkeyup="javascript:backspacerUP(this,event);" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Email" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                     <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputfield id="Email" value="{!contactObj.Email}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <!-- 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Mobile Phone" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="mobilePhone" value="{!contactObj.mobilephone}" onkeydown="javascript:backspacerDOWN(this,event);" onkeyup="javascript:backspacerUP(this,event);" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                 -->                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Email Opt Out" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="EmailOptOut" value="{!contactObj.HasOptedOutOfEmail}">
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Best Way To Reach" />                   
                        <apex:inputfield id="bestwaytoreach" value="{!opportunity.Best_way_to_reach__c}">
                        </apex:inputfield>                 
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Preferred Language"/>
                    <apex:inputField value="{!contactObj.Preferred_Language__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem rendered="{!!isAEEUser}">
                    <apex:outputLabel value="Hawaii NEM Approved"/>
                    <apex:inputField value="{!Opportunity.Hawaii_NEM_Approved__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>
             
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Notes"/>
                    <apex:inputField value="{!Opportunity.Notes__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>                                             
            </apex:pageblocksection>
                <apex:inputfield id="state" value="{!accountObj.State__c}" style="display:none" styleClass="page-address-state">
                            <apex:actionSupport rerender="utilitiySection" event="onchange" action="{!getUtilities}"/>
                </apex:inputfield> 
            <apex:pageblocksection id="utilitiySection" title="Utility Information" columns="2"  > 
                <apex:outputpanel style="display:none;">
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.State__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.State__c.label}" for="state" />                      
                        <apex:inputfield id="State" value="{!opportunity.State__c}" style="display:none !important;"/>                    
                </apex:pageBlockSectionItem>
                </apex:outputpanel>
                 <apex:pageBlockSectionItem />              
                 <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Utility_Company__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Utility_Company__c.label}" for="UtilityCompany" />                      
                        <apex:inputfield id="UtilityCompany" value="{!opportunity.Utility_Company__c}"/>
                </apex:pageBlockSectionItem>                
                               
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Territory__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Territory__c.label}" for="territory" />                      
                        <apex:inputfield id="territory" value="{!opportunity.Territory__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Usage_Option__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Usage_Option__c.label}" for="UsageOption"/>                      
                        <apex:inputfield id="usageOption" value="{!opportunity.Usage_Option__c}" />
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Rate_Schedule__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Rate_Schedule__c.label}" for="RateSchedule"/>                      
                        <apex:inputfield id="usageOption" value="{!opportunity.Rate_Schedule__c}" />
                </apex:pageBlockSectionItem>                                                                      
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Jan_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Jan_Usage__c.label}" for="JanUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="JanUsage" value="{!opportunity.Jan_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Feb_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Feb_Usage__c.label}" for="FebUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="FebUsage" value="{!opportunity.Feb_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Mar_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Mar_Usage__c.label}" for="MarUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="MarUsage" value="{!opportunity.Mar_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Apr_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Apr_Usage__c.label}" for="AprUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="AprUsage" value="{!opportunity.Apr_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.May_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.May_Usage__c.label}" for="MayUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="MayUsage" value="{!opportunity.May_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Jun_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Jun_Usage__c.label}" for="JunUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="JunUsage" value="{!opportunity.Jun_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Jul_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Jul_Usage__c.label}" for="JulUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="JulUsage" value="{!opportunity.Jul_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Aug_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Aug_Usage__c.label}" for="AugUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="AugUsage" value="{!opportunity.Aug_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Sep_Usage__c.inlineHelpText}" >
                   <apex:outputLabel value="{!$ObjectType.opportunity.fields.Sep_Usage__c.label}" for="SepUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="SepUsage" value="{!opportunity.Sep_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Oct_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Oct_Usage__c.label}" for="OctUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="OctUsage" value="{!opportunity.Oct_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Nov_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Nov_Usage__c.label}" for="NovUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="NovUsage" value="{!opportunity.Nov_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Dec_Usage__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Dec_Usage__c.label}" for="DecUsage" />
                    <apex:outputPanel layout="block" styleClass="requiredInput"> 
                      <apex:outputPanel layout="block" styleClass="myrequiredBlock" />
                        <apex:inputField id="DecUsage" value="{!opportunity.Dec_Usage__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                 <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Square_footage__c.label}" for="squarefootage"/>                      
                        <apex:inputfield id="squarefootage" value="{!opportunity.Square_footage__c}" />
                </apex:pageBlockSectionItem>                  
      <!--          <apex:pageBlockSectionItem helpText="{!$ObjectType.opportunity.Fields.Average_Monthly_Electric_Bill__c.inlineHelpText}" >
                    <apex:outputLabel value="{!$ObjectType.opportunity.fields.Average_Monthly_Electric_Bill__c.label}" for="AverageMonthlyElectricBill" />                      
                        <apex:inputfield id="AverageMonthlyElectricBill" value="{!opportunity.Average_Monthly_Electric_Bill__c}"> -->
                       <!--  <apex:actionSupport event="onkeyup" action="{!calculateMonUsage}" /> -->
      <!--                </apex:inputfield>
                 </apex:pageBlockSectionItem>  -->
                <apex:pageBlockSectionItem rendered="{!!isAEEUser}">
                <apex:outputLabel value="Consumption Meter"/>
                <apex:actionRegion >
 
                    <apex:inputField value="{!Opportunity.Energy_Storage_Applicable__c}" >
                    <apex:actionSupport reRender="retOP" event="onchange" action="{!onChangeEnergyApplicable}" />
                    </apex:inputField> 
                </apex:actionRegion>                    
                </apex:pageBlockSectionItem> 
             </apex:pageblocksection>
                
             <apex:pageBlockSection title="Opportunity Detail" columns="2">   
             <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.SalesRep__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SalesRep__c.label}"/>
                <apex:inputField value="{!Opportunity.SalesRep__c}">
                </apex:inputField>
               </apex:pageBlockSectionItem>             
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.stagename.inlineHelpText}">
                <apex:outputLabel value="Opportunity Stage"/>
                <apex:inputField value="{!Opportunity.stagename}">
                </apex:inputField>
              </apex:pageBlockSectionItem>
             <!-- <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Ready_for__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Ready_for__c.label}"/>
                <apex:inputField value="{!Opportunity.Ready_for__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>  -->
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Opportunity_Status__c.inlineHelpText}">
                <apex:outputLabel value="Closed Reason"/>
                <apex:inputField value="{!Opportunity.Opportunity_Status__c}" >
                </apex:inputField>
              </apex:pageBlockSectionItem>  
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Designer__c.inlineHelpText}" rendered="{!!isAEEUser}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Designer__c.label}"/>
                <apex:inputField value="{!Opportunity.Designer__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>          
    <!--        <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Why_Closed_Lost__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Why_Closed_Lost__c.label}"/>
                <apex:inputField value="{!Opportunity.Why_Closed_Lost__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>  -->
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.ownerid.inlineHelpText}">
                <apex:outputLabel value="Opportunity Owner"/>
                <apex:outputField value="{!Opportunity.ownerid}">
                </apex:outputField>
              </apex:pageBlockSectionItem>                    
    <!--        <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Lead_Qualifier__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Lead_Qualifier__c.label}"/>
                <apex:inputField value="{!Opportunity.Lead_Qualifier__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>  -->  
   <!--         <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Why_Unqualified__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Why_Unqualified__c.label}"/>
                <apex:inputField value="{!Opportunity.Why_Unqualified__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>  -->
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Opportunity_Source_Type__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Opportunity_Source_Type__c.label}"/>
                <apex:inputField value="{!Opportunity.Opportunity_Source_Type__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem> 
   <!--         <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.closedate.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.closedate.label}"/>
                <apex:inputField value="{!Opportunity.closedate}">
                </apex:inputField>
              </apex:pageBlockSectionItem>   -->               
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Prospect_Id__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Prospect_Id__c.label}"/>
                <apex:inputField value="{!Opportunity.Prospect_Id__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>  
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Deal_Id__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Deal_Id__c.label}"/>
                <apex:inputField value="{!Opportunity.Deal_Id__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>                                    
              <!-- 
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Reason__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Reason__c.label}"/>
                <apex:inputField value="{!Opportunity.Reason__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>                      
               -->
               
            </apex:pageBlockSection>
        
            <apex:pageBlockSection title="Design" columns="2">   
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Ready_for__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Ready_for__c.label}"/>
                    <apex:inputField value="{!Opportunity.Ready_for__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>  
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Site_Design_Status__c.inlineHelpText}" rendered="{!!isAEEUser}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Site_Design_Status__c.label}"/>
                    <apex:inputField value="{!Opportunity.Site_Design_Status__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>  
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Site_Design_Priority__c.inlineHelpText}" rendered="{!!isAEEUser}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Site_Design_Priority__c.label}"/>
                    <apex:inputField value="{!Opportunity.Site_Design_Priority__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>  
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Site_Designer__c.inlineHelpText}" rendered="{!!isAEEUser}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Site_Designer__c.label}"/>
                    <apex:inputField value="{!Opportunity.Site_Designer__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>   
            </apex:pageBlockSection>
             <apex:outputPanel id="retOP">
                    <apex:outputText rendered="{!!IsEngStApplicable}">
                                <script type="text/javascript">
                                var errorMessageStr = 'Consumption Metering data will be deleted when unchecked. Are you sure?';
                                alert(errorMessageStr);
                                </script>
                    </apex:outputText>
            <apex:pageBlockSection title="Demographics and bill inputs" rendered="{!Opportunity.Energy_Storage_Applicable__c}">
                <apex:inputfield id="YearlykWhconsumption" value="{!energyStorage.Yearly_kWh_consumption__c}">
                </apex:inputfield>
                <apex:inputfield id="Numberofadultshomeduringtheday" value="{!energyStorage.Number_of_adults_home_during_the_day__c}">
                </apex:inputfield>  
                <apex:inputfield id="Timereturnfromwork" value="{!energyStorage.Time_return_from_work__c}">
                </apex:inputfield>
                <apex:inputfield id="UseAC" value="{!energyStorage.Use_A_C__c}">
                </apex:inputfield>
                <apex:inputfield id="Electricvehiclechargedafter4PM" value="{!energyStorage.Electric_vehicle_charged_after_4PM__c}">
                </apex:inputfield>
                <apex:inputfield id="PVTurnkey" value="{!energyStorage.PV_Turnkey__c}">
                </apex:inputfield>
                <apex:inputfield id="CurrentBlendedUtilityRate" value="{!energyStorage.Current_Blended_Utility_Rate__c}">
                </apex:inputfield>
            </apex:pageBlockSection>   
            <apex:pageBlockSection title="PV+ES calculator outputs" rendered="{!Opportunity.Energy_Storage_Applicable__c}">
                <apex:inputfield id="PVkWdc" value="{!energyStorage.PV_kWdc__c}">
                </apex:inputfield>
                <apex:inputfield id="ESkWh" value="{!energyStorage.ES_kWh__c}">
                </apex:inputfield>
                <apex:inputfield id="Monthly20YearPPALeasePayment" value="{!energyStorage.Monthly_20_Year_PPA_Lease_Payment__c}">
                </apex:inputfield>
                <apex:inputfield id="Monthly20YearSavings" value="{!energyStorage.Monthly_20_Year_Savings__c}">
                </apex:inputfield>
                <apex:inputfield id="Prepaid20YearPPALease" value="{!energyStorage.Prepaid_20_Year_PPA_Lease__c}">
                </apex:inputfield>
                <apex:inputfield id="Prepaid20YearPPALeaseSavings" value="{!energyStorage.Prepaid_20_Year_PPA_Lease_Savings__c}">
                </apex:inputfield>
                    
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Consumption Meter" rendered="{!Opportunity.Energy_Storage_Applicable__c}">
                <apex:inputfield id="MeterSensorID" value="{!energyStorage.Meter_Sensor_ID__c}">
                </apex:inputfield>
                <apex:inputfield id="DateofMeterInstall" value="{!energyStorage.Date_of_Meter_Instal__c}">
                </apex:inputfield>
            </apex:pageBlockSection>  
            <apex:pageBlockSection title="Consumption Meter Documents" rendered="{!Opportunity.Energy_Storage_Applicable__c}" columns="1">
               <!-- <apex:iframe src="/apex/Opportunity_eSignDocuments?id={!OpptyId}"/> -->
                    <apex:iframe src="/partner/Opportunity_eSignDocuments?id={!OpptyId}" height="200"/> 
            </apex:pageBlockSection>    
            </apex:outputPanel>
            <!--           
             <apex:pageBlockSection title="Appointment">
              <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Appointment Type Requested"/>
                    <apex:inputField value="{!Opportunity.Sales_Contact_Method__c}">
                    </apex:inputField>
                </apex:pageBlockSectionItem>                            
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Site_Visit_Date_Time__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Site_Visit_Date_Time__c.label}"/>
                <apex:inputField value="{!Opportunity.Site_Visit_Date_Time__c}">
                </apex:inputField>
               </apex:pageBlockSectionItem>  
               <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Consultation_Time__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Consultation_Time__c.label}"/>
                <apex:inputField value="{!Opportunity.Consultation_Time__c}">
                </apex:inputField>
               </apex:pageBlockSectionItem>                     
            </apex:pageBlockSection> 
            -->            
            <!--
            <apex:pageBlockSection title="Promotion Information">
            <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Offer_Promotion_Name__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Offer_Promotion_Name__c.label}"/>
                <apex:inputField value="{!Opportunity.Offer_Promotion_Name__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem> 
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Referral_Promotion_Name__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Referral_Promotion_Name__c.label}"/>
                <apex:inputField value="{!Opportunity.Referral_Promotion_Name__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Offer__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Offer__c.label}"/>
                <apex:inputField value="{!Opportunity.Offer__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>            
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Sales_rep_of_referrer__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Sales_rep_of_referrer__c.label}"/>
                <apex:inputField value="{!Opportunity.Sales_rep_of_referrer__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>
              <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.Fields.Referral__c.inlineHelpText}">
                <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Referral__c.label}"/>
                <apex:inputField value="{!Opportunity.Referral__c}">
                </apex:inputField>
              </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            -->
              <!-- 
               <apex:pageblocksection title="Design Information">
               <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Unable to create proposal" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="unable" value="{!opportunity.Unable_to_create_proposal__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Request redesign" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="reqRed" value="{!opportunity.Request_redesign__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Reason for not generating proposal" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="reasonForNGP" value="{!opportunity.Reason_for_not_generating_proposal__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Reason for redesign" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="reasonForReDe" value="{!opportunity.Reason_for_redesign__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Date and time" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="dtreq" value="{!opportunity.Date_and_time_request__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                                               
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Date and time" />
                    <apex:outputPanel layout="block">
                        <apex:inputfield id="dtRes" value="{!opportunity.Date_and_time_response__c}" >
                        </apex:inputfield>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
             </apex:pageblocksection>
              -->
                     
        </apex:pageblock>
           <div align="center">
                <apex:commandButton id="saveButton" title="Submit" value="  Save " action="{!submit}"/>
                &nbsp;
                <apex:commandButton action="{!cancel}" value="Cancel" onclick="return confirmCancel()" immediate="true"/>
            </div>
    </apex:form>
        <script language="javascript">
    
        function redirectToEdit(noteID)
        {   
            var tempURL = '/partner/apex/opportunityEditNotePage?Id='+ noteID; 
     
            var newwindow = window.open(tempURL, '', 'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=650,height=390,left=150,top=150'); 
            newwindow.focus();
        }
    


<!-- This script is based on the javascript code of Roman Feldblum (web.developer@programmer.net) -->
<!-- Original script : http://javascript.internet.com/forms/format-phone-number.html -->
<!-- Original script is revised by Eralper Yilmaz (http://www.eralper.com) -->
<!-- Revised script : http://www.kodyaz.com -->
<!-- Format : "(123) 456-7890" -->

var zChar = new Array(' ', '(', ')', '-', '.');
var maxphonelength = 14;
var phonevalue1;
var phonevalue2;
var cursorposition;

function ParseForNumber1(object){
  phonevalue1 = ParseChar(object.value, zChar);
}

function ParseForNumber2(object){
  phonevalue2 = ParseChar(object.value, zChar);
}

function backspacerUP(object,e) { 
  if(e){ 
    e = e 
  } else {
    e = window.event 
  } 
  if(e.which){ 
    var keycode = e.which 
  } else {
    var keycode = e.keyCode 
  }

  ParseForNumber1(object)

  if(keycode >= 48){
    ValidatePhone(object)
  }
}

function backspacerDOWN(object,e) { 
  if(e){ 
    e = e 
  } else {
    e = window.event 
  } 
  if(e.which){ 
    var keycode = e.which 
  } else {
    var keycode = e.keyCode 
  }
  ParseForNumber2(object)
} 

function GetCursorPosition(){

  var t1 = phonevalue1;
  var t2 = phonevalue2;
  var bool = false
  for (i=0; i<t1.length; i++)
  {
    if (t1.substring(i,1) != t2.substring(i,1)) {
      if(!bool) {
        cursorposition=i
        window.status=cursorposition
        bool=true
      }
    }
  }
}

function ValidatePhone(object){

  var p = phonevalue1

  p = p.replace(/[^\d]*/gi,"")

  if (p.length < 3) {
    object.value=p
  } else if(p.length==3){
    pp=p;
    d4=p.indexOf('(')
    d5=p.indexOf(')')
    if(d4==-1){
      pp="("+pp;
    }
    if(d5==-1){
      pp=pp+")";
    }
    object.value = pp;
  } else if(p.length>3 && p.length < 7){
    p ="(" + p; 
    l30=p.length;
    p30=p.substring(0,4);
    p30=p30+") " 

    p31=p.substring(4,l30);
    pp=p30+p31;

    object.value = pp; 

  } else if(p.length >= 7){
    p ="(" + p; 
    l30=p.length;
    p30=p.substring(0,4);
    p30=p30+") " 

    p31=p.substring(4,l30);
    pp=p30+p31;

    l40 = pp.length;
    p40 = pp.substring(0,9);
    p40 = p40 + "-"

    p41 = pp.substring(9,l40);
    ppp = p40 + p41;

    object.value = ppp.substring(0, maxphonelength);
  }

  GetCursorPosition()

  if(cursorposition >= 0){
    if (cursorposition == 0) {
      cursorposition = 2
    } else if (cursorposition <= 2) {
      cursorposition = cursorposition + 1
    } else if (cursorposition <= 4) {
      cursorposition = cursorposition + 3
    } else if (cursorposition == 5) {
      cursorposition = cursorposition + 3
    } else if (cursorposition == 6) { 
      cursorposition = cursorposition + 3 
    } else if (cursorposition == 7) { 
      cursorposition = cursorposition + 4 
    } else if (cursorposition == 8) { 
      cursorposition = cursorposition + 4
      e1=object.value.indexOf(')')
      e2=object.value.indexOf('-')
      if (e1>-1 && e2>-1){
        if (e2-e1 == 4) {
          cursorposition = cursorposition - 1
        }
      }
    } else if (cursorposition == 9) {
      cursorposition = cursorposition + 4
    } else if (cursorposition < 11) {
      cursorposition = cursorposition + 3
    } else if (cursorposition == 11) {
      cursorposition = cursorposition + 1
    } else if (cursorposition == 12) {
      cursorposition = cursorposition + 1
    } else if (cursorposition >= 13) {
      cursorposition = cursorposition
    }

    var txtRange = object.createTextRange();
    txtRange.moveStart( "character", cursorposition);
    txtRange.moveEnd( "character", cursorposition - object.value.length);
    txtRange.select();
  }

}

function ParseChar(sStr, sChar)
{

  if (sChar.length == null) 
  {
    zChar = new Array(sChar);
  }
    else zChar = sChar;

  for (i=0; i<zChar.length; i++)
  {
    sNewStr = "";

    var iStart = 0;
    var iEnd = sStr.indexOf(sChar[i]);

    while (iEnd != -1)
    {
      sNewStr += sStr.substring(iStart, iEnd);
      iStart = iEnd + 1;
      iEnd = sStr.indexOf(sChar[i], iStart);
    }
    sNewStr += sStr.substring(sStr.lastIndexOf(sChar[i]) + 1, sStr.length);

    sStr = sNewStr;
  }

  return sNewStr;
}

    </script>
     <style type="text/css">
        .glyphicon{
            font-family:Glyphicons Halflings !Important;                
        } 
        .requiredInput{                     
            display:inline-table;
            width:180px !Important;
            color: black !Important;         
        }        
        #address-lookup{
            padding-top:1px !Important;
            color: white !Important;
        }          
        .address-zip{                       
            width:54px !Important;
         }  
         .address-state, .address-zip {
             margin-left: 3px !Important;
        }
        .address-line1 {
            min-width:210px !Important;
            width:210px !Important;
        }
        .address-city {
            width: 180px !Important;
        }   
        .redrequired, .bluerequired {
          right: 180px !Important;
          }    
         .paginatorWrap{
            //background: url("/img/alohaSkin/listFooter.png") repeat-x scroll 0 0 #F2F2F2;
            //border: 1px solid #EAEAEA;
            //background-color: #F3F3F3;
            //border-top: 1px solid #FFFFFF;
            padding: 3px;
        }
        .noRecordsFound{
            border: 1px solid #D4DADC;
            padding: 4px;
        }
        a:hover {
            background:#ffffff; /*BG color is a must for IE6*/
            text-decoration:none;
            
        } 
        a.tooltip span {
            display:none; 
            padding:2px 3px; 
            margin-left:8px; 
            width:300px;
            height:70px;
            opacity: 12.3;
        }
        a.tooltip:hover span{
            display:inline; 
            position:absolute; 
            background:#EEF1F5; 
            border:2px solid #cccccc; 
            color:#000000;
        }
        
    .myrequiredBlock {
        background-color: #3300FF !important;
        bottom: 1px;
        left: -4px;
        position: absolute;
        top: 1px;
        width: 3px;
    }
    
     .redrequired {
        background-color: #CC0000 !important;
        bottom: 1px;
        //left: 0px;
        position: absolute;
        right: 180px !Important;
        top: 1px;
        width: 3px;
    }
    
    .bluerequired {
        background-color: #3300FF !important;
        bottom: 1px;
        //left: 0px;
        position: absolute;
        right: 180px !Important;
        top: 1px;
        width: 3px;
    }    
    </style>    
</apex:page>